/**
 * Colio - jQuery Portfolio Content Expander Plugin
 * http://plugins.gravitysign.com/colio
 * Copyright (c) 2013 Roman Yurchuk
 * Version 1.0 # 02/12/13
 */
 
(function(a,b){function c(f,e){this.list=a(f);this.items=this.list.children();this.settings=e;this.position=0;this.active_id=b;this.lock=false;var d=this;this.items.addClass("colio-item");this.markup=a('<div class="colio"></div>');this.markup.append('<div class="colio-container"></div>');if(this.settings.navigation){a('<div class="colio-navigation"></div>').append('<a class="colio-prev" href="#">'+this.settings.prevText+"</a>").append('<a class="colio-next" href="#">'+this.settings.nextText+"</a>").appendTo(this.markup)}this.markup.append('<a class="colio-close" href="#">'+this.settings.closeText+"</a>");if(this.settings.placement==="after"){this.list.after(this.markup)}else{if(this.settings.placement==="inside"){this.markup.css({position:"absolute",top:0,left:0});a("body").append(this.markup)}else{if(/^#\w/.test(this.settings.placement)){a(this.settings.placement).append(this.markup);this.settings.placement="element"}else{this.list.before(this.markup);this.settings.placement="before"}}}if(this.settings.id){this.markup.attr("id",this.settings.id)}this.markup.addClass("colio-placement-"+this.settings.placement);if(this.settings.theme){this.markup.addClass("colio-theme-"+this.settings.theme)}this.items.find(this.settings.expandLink).click(function(){d.page_scroll=a(window).scrollTop();var g=a(this).closest(".colio-item");d.expand(g);return false});this.markup.find(".colio-close").click(function(){d.collapse();return false});this.markup.find(".colio-prev").click(function(){if(!d.lock&&d.position>0){d.position--;d.expand(d.items.eq(d.position))}return false}).end().find(".colio-next").click(function(){if(!d.lock&&d.position<d.items.length-1){d.position++;d.expand(d.items.eq(d.position))}return false});a(window).resize(function(){if(d.settings.placement==="inside"){d.insideHideViewport()}clearTimeout(d.resize_timer);d.resize_timer=setTimeout(function(){d.expandViewport(d.active_id,true)},200)});this.api={expand:function(g){d.expand(d.items.eq(g))},collapse:function(){d.collapse()},excludeHidden:function(){d.items=d.list.children(":not("+d.settings.hiddenItems+")");d.position=d.items.index(d.list.find(".colio-active-item"));if(d.settings.placement==="inside"){d.insideHideViewport()}}};this.list.data("colio",this.api);this.list.bind("colio",function(g,i,h){if(d.api.hasOwnProperty(i)){d.api[i](h)}})}c.prototype.expand=function(f){var e=f.data("content");if(this.lock||!e){return}this.lock=true;this.position=this.items.index(f);if(this.settings.placement==="inside"){this.insidePositionViewport(f)}var d=f.data("colio-content-id");if(d){if(this.settings.placement==="inside"){this.insideMakeGap(f)}this.expandViewport(d)}else{this.loadContent(e,function(g){f.data("colio-content-id",g);if(this.settings.placement==="inside"){this.insideMakeGap(f)}this.expandViewport(g)})}this.markup.find(".colio-navigation a").removeClass("colio-no-prev colio-no-next");if(this.position===0){this.markup.find(".colio-prev").addClass("colio-no-prev")}if(this.position===this.items.length-1){this.markup.find(".colio-next").addClass("colio-no-next")}this.items.removeClass("colio-active-item");f.addClass("colio-active-item")};c.prototype.loadContent=function(g,i){var d=this;var h=function(k){k=a(k);if(d.settings.contentFilter){k=k.filter(d.settings.contentFilter);if(k.length===0){k=k.end().find(d.settings.contentFilter)}}var j="colio_"+Math.floor(Math.random()*100000);a('<div id="'+j+'" class="colio-content"></div>').append(k).appendTo(d.markup.find(".colio-container"));if(typeof d.settings.onContent==="function"){d.settings.onContent.call(d.markup.get(0),d.markup.find("#"+j).get(0))}return j};if(/^#\w/.test(g)){var f=a(g).html();var e=h(f);setTimeout(function(){i.call(d,e)},20)}else{if(/(^\.{0,2}\/+\w)|(^https?:\/\/\w)/.test(g)){a.get(g,function(j){i.call(d,h(j))})}else{var e=h(g);setTimeout(function(){i.call(d,e)},20)}}};c.prototype.expandViewport=function(d,i){var h=this.settings.expandDuration,j=this.settings.expandEasing,e=this.settings.syncScroll,g=this.markup.offset().top-parseInt(this.settings.scrollOffset,10),f=this.getViewportHeight(d);if(f===0||(!i&&d===this.active_id)){this.lock=false;return}this.switchContent(d);this.markup.stop().animate({height:f},h,j,a.proxy(function(){this.markup.addClass("colio-expanded");this.scroll(g,!e);this.lock=false;if(typeof this.settings.onExpand==="function"){this.settings.onExpand.call(this.markup.get(0),this.items.eq(this.position).get(0))}},this));this.scroll(g,e)};c.prototype.switchContent=function(d){var e=this.markup.find("#"+this.active_id),f=this.markup.find("#"+d);if(this.active_id===d){return}if(e.length){e.stop().fadeOut(this.settings.contentFadeOut,a.proxy(function(){f.fadeIn(this.settings.contentFadeIn)},this))}else{f.delay(this.settings.contentDelay).fadeIn(this.settings.contentFadeIn)}this.active_id=d};c.prototype.getViewportHeight=function(f){var e=this.markup.find(".colio-container"),i=e.width(),g=e.outerHeight()-e.height(),h=this.markup.find("#"+f),d=0;if(h.is(":visible")){d=h.height()}else{h.css({display:"block",position:"absolute",visibility:"hidden",width:i});d=h.height();h.css({display:"",position:"",visibility:"",width:""})}return d>0?d+g:0};c.prototype.scroll=function(f,d){var e=this.settings.scrollDuration,g=this.settings.scrollEasing;if(d){a("body, html").stop().animate({scrollTop:f},e,g)}};c.prototype.collapse=function(){var e=this.settings.collapseDuration,f=this.settings.collapseEasing,d=this.settings.syncScroll;this.active_id=b;this.position=b;this.markup.stop().animate({height:0},e,f,a.proxy(function(){this.markup.find(".colio-content:visible").hide();this.items.removeClass("colio-active-item");this.scroll(this.page_scroll,!d);if(typeof this.settings.onCollapse==="function"){this.settings.onCollapse.call(this.markup.get(0),this.items.eq(this.position).get(0))}},this));this.markup.removeClass("colio-expanded");if(this.settings.placement==="inside"){this.insideJoinGap()}this.scroll(this.page_scroll,d)};c.prototype.insideBottomItems=function(f){var e=Math.floor(this.list.width()/f.outerWidth(true));e=Math.max(1,e);var d=Math.ceil(this.items.length/e),g=Math.floor(this.items.index(f)/e);if(g<d-1){g=g+1}return this.items.slice(g*e)};c.prototype.insideMakeGap=function(e){var g=this.settings.expandDuration,i=this.settings.expandEasing;var d=e.data("colio-content-id");var f=this.getViewportHeight(d);f+=parseFloat(this.markup.css("margin-bottom"));a.each(this.insideBottomItems(e),function(){var j=a(this).data("colio-item-top");if(j===b){j=parseFloat(a(this).css("top"));a(this).data("colio-item-top",j)}a(this).addClass("colio-bottom-item");a(this).stop().animate({top:j+f},g,i)});var h=this.list.data("colio-list-height");if(h===b){h=this.list.height();this.list.data("colio-list-height",h)}this.list.height(h+f)};c.prototype.insideJoinGap=function(d){var e=this.settings.collapseDuration,g=this.settings.collapseEasing;this.items.filter(".colio-bottom-item").each(function(){var h=a(this).data("colio-item-top")||0;if(d){a(this).css("top",h)}else{a(this).stop().animate({top:h},e,g)}a(this).removeData("colio-item-top").removeClass("colio-bottom-item")});var f=this.list.data("colio-list-height");this.list.removeData("colio-list-height").height(f)};c.prototype.insidePositionViewport=function(g){var h=this.insideBottomItems(g);if(this.active_id){var k=this.items.filter(".colio-bottom-item");if(k.length!==h.length){this.insideHideViewport();this.insidePositionViewport(g)}}else{if(/absolute|relative/.test(this.items.eq(0).css("position"))===false){this.items.css({position:"relative",top:0,left:0})}var e=parseFloat(this.markup.css("margin-left")),f=parseFloat(this.markup.css("margin-right")),j=this.list.offset().left+e,i=this.list.width()-(e+f),d=h.offset().top;this.markup.css({top:d,left:j,width:i})}};c.prototype.insideHideViewport=function(){if(this.active_id===b){return}this.active_id=b;this.insideJoinGap(true);this.markup.height(0).find(".colio-content:visible").hide();this.items.removeClass("colio-active-item");this.markup.removeClass("colio-expanded")};a.fn.colio=function(e){var d=a.extend({id:"colio",theme:"",placement:"before",expandLink:".colio-link",expandDuration:500,expandEasing:"swing",collapseDuration:300,collapseEasing:"swing",scrollDuration:300,scrollEasing:"swing",syncScroll:false,scrollOffset:10,contentFadeIn:500,contentFadeOut:200,contentDelay:200,navigation:true,closeText:"<span>Close</span>",nextText:"<span>Next</span>",prevText:"<span>Prev</span>",contentFilter:"",hiddenItems:".hidden",onExpand:function(){},onCollapse:function(){},onContent:function(){}},e);return this.each(function(){var f=new c(this,d)})}})(jQuery);